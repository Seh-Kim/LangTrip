::0. 환경변수 세팅set WORKSPACE=%cd%set IMAGE_NAME=sehkim/e_learning_prj:latestset CONTAINER_NAME=e_learning_prj-appset SSH_KEY=C:\Users\user\.ssh\id_rsaset REMOTE_PORT=200set REMOTE_USER=rootset REMOTE_HOST=192.168.56.1set JAR_NAME=e_learning_prj-0.0.1-SNAPSHOT.jarset REMOTE_APP_DIR=/root/e_learning_prj:: Sensitive Environment Variables (PLACEHOLDERS - REPLACE WITH ACTUAL SECRETS)set DB_URL=jdbc:oracle:thin:@YOUR_DB_HOST:1521:YOUR_DB_SIDset DB_USERNAME=YOUR_DB_USERNAMEset DB_PASSWORD=YOUR_DB_PASSWORDset DB_DRIVER=oracle.jdbc.driver.OracleDriverset MAIL_HOST=smtp.gmail.comset MAIL_PORT=587set MAIL_USERNAME=YOUR_EMAIL_USERNAMEset MAIL_PASSWORD=YOUR_EMAIL_PASSWORDset MAIL_AUTH=trueset MAIL_STARTTLS=trueset MAIL_PROTOCOL=smtpset KAKAO_CLIENT_ID=YOUR_KAKAO_CLIENT_IDset KAKAO_CLIENT_SECRET=YOUR_KAKAO_CLIENT_SECRETset KAKAO_AUTH_GRANT_TYPE=authorization_codeset KAKAO_REDIRECT_URI={baseUrl}/login/oauth2/code/{registrationId}set KAKAO_SCOPE=set KAKAO_CLIENT_NAME=Kakaoset KAKAO_AUTH_URI=https://kauth.kakao.com/oauth/authorizeset KAKAO_TOKEN_URI=https://kauth.kakao.com/oauth/tokenset KAKAO_USER_INFO_URI=https://kapi.kakao.com/v2/user/meset KAKAO_USER_NAME_ATTRIBUTE=idset GOOGLE_CLIENT_ID=YOUR_GOOGLE_CLIENT_IDset GOOGLE_CLIENT_SECRET=YOUR_GOOGLE_CLIENT_SECRETset GOOGLE_SCOPE=set GOOGLE_AUTH_URI=https://accounts.google.com/o/oauth2/v2/authset GOOGLE_TOKEN_URI=https://oauth2.googleapis.com/tokenset GOOGLE_USER_INFO_URI=https://www.googleapis.com/oauth2/v3/userinfoset GOOGLE_USER_NAME_ATTRIBUTE=subset OPENAI_API_KEY=YOUR_OPENAI_API_KEYset OPENAI_API_URL=https://api.openai.com/v1/chat/completions::1. 빌드할 폴더를 생성 ( Dockerfile, application.properites 복사 )if not exist %WORKSPACE%\docker-build mkdir %WORKSPACE%\docker-build::2. Maven clean installcall mvn clean install::3. Dockerfile 복사copy  %WORKSPACE%\Dockerfile %WORKSPACE%\docker-build\Dockerfile::4. application-prod.properties 복사copy  %WORKSPACE%\src\main\resources\application-prod.properties %WORKSPACE%\docker-build\application-prod.properties::5. MAVEN으로  build 된 jar를  docker-build복사copy %WORKSPACE%\target\%JAR_NAME% %WORKSPACE%\docker-build\%JAR_NAME%::6.이미지 빌드cd %WORKSPACE%\docker-builddocker build -t %IMAGE_NAME% .::7. Docker Hub로그인 ( 비밀번호를 echo 로 출력하면 외부에 노출되지 않는다. )echo %DOCKER-PASSWORD% | docker login -u %DOCKER-USERNAME% --password-stdin::8. 이미지 푸시 ( 이미지 생성시 태깅이 되었기 때문에 tag를 할 필요가 없다.)docker push %IMAGE_NAME%::9. 서버에 application-prod.properties를 전송scp -i "%SSH_KEY%" -P %REMOTE_PORT% %WORKSPACE%\docker-build\application-prod.properties %REMOTE_USER%@%REMOTE_HOST%:%REMOTE_APP_DIR%::10. upload 디렉토리  생성ssh -i "%SSH_KEY%" -p %REMOTE_PORT% %REMOTE_USER%@%REMOTE_HOST% "mkdir -p %REMOTE_APP_DIR%\upload"::11. Docker Hub에서 이미지 받고, 컨테이너 중지, 사게, 새로운 컨테이너 실행ssh -i "%SSH_KEY%" -p %REMOTE_PORT% %REMOTE_USER%@%REMOTE_HOST% "docker pull %IMAGE_NAME%; docker rm -f %CONTAINER_NAME%; docker run -d -p 8081:8081 \-v %REMOTE_APP_DIR%\application-prod.properties:/app/application-prod.properties \-v %REMOTE_APP_DIR%\upload:/app/upload \-e SPRING_DATASOURCE_URL=\"%DB_URL%\" \-e SPRING_DATASOURCE_USERNAME=\"%DB_USERNAME%\" \-e SPRING_DATASOURCE_PASSWORD=\"%DB_PASSWORD%\" \-e SPRING_DATASOURCE_DRIVER_CLASS_NAME=\"%DB_DRIVER%\" \-e SPRING_MAIL_HOST=\"%MAIL_HOST%\" \-e SPRING_MAIL_PORT=\"%MAIL_PORT%\" \-e SPRING_MAIL_USERNAME=\"%MAIL_USERNAME%\" \-e SPRING_MAIL_PASSWORD=\"%MAIL_PASSWORD%\" \-e SPRING_MAIL_PROPERTIES_MAIL_SMTP_AUTH=\"%MAIL_AUTH%\" \-e SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE=\"%MAIL_STARTTLS%\" \-e SPRING_MAIL_TRANSPORT_PROTOCOL=\"%MAIL_PROTOCOL%\" \-e SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KAKAO_CLIENT_ID=\"%KAKAO_CLIENT_ID%\" \-e SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KAKAO_CLIENT_SECRET=\"%KAKAO_CLIENT_SECRET%\" \-e SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KAKAO_AUTHORIZATION_GRANT_TYPE=\"%KAKAO_AUTH_GRANT_TYPE%\" \-e SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KAKAO_REDIRECT_URI=\"%KAKAO_REDIRECT_URI%\" \-e SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KAKAO_SCOPE=\"%KAKAO_SCOPE%\" \-e SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KAKAO_CLIENT_NAME=\"%KAKAO_CLIENT_NAME%\" \-e SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_KAKAO_AUTHORIZATION_URI=\"%KAKAO_AUTH_URI%\" \-e SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_KAKAO_TOKEN_URI=\"%KAKAO_TOKEN_URI%\" \-e SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_KAKAO_USER_INFO_URI=\"%KAKAO_USER_INFO_URI%\" \-e SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_KAKAO_USER_NAME_ATTRIBUTE=\"%KAKAO_USER_NAME_ATTRIBUTE%\" \-e SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GOOGLE_CLIENT_ID=\"%GOOGLE_CLIENT_ID%\" \-e SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GOOGLE_CLIENT_SECRET=\"%GOOGLE_CLIENT_SECRET%\" \-e SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GOOGLE_SCOPE=\"%GOOGLE_SCOPE%\" \-e SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_GOOGLE_AUTHORIZATION_URI=\"%GOOGLE_AUTH_URI%\" \-e SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_GOOGLE_TOKEN_URI=\"%GOOGLE_TOKEN_URI%\" \-e SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_GOOGLE_USER_INFO_URI=\"%GOOGLE_USER_INFO_URI%\" \-e SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_GOOGLE_USER_NAME_ATTRIBUTE=\"%GOOGLE_USER_NAME_ATTRIBUTE%\" \-e API_KEY=\"%OPENAI_API_KEY%\" \-e API_URL=\"%OPENAI_API_URL%\" \--name %CONTAINER_NAME% %IMAGE_NAME%"