<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>강의 추천 게시글 작성</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.min.js"></script>
  <style>
    body {
      background-color: #ffffff;
      font-family: 'Malgun Gothic', sans-serif;
    }
    h3 {
      border-bottom: 2px solid #000;
      padding-bottom: 10px;
      margin-bottom: 30px;
      font-weight: bold;
    }
    label {
      font-weight: bold;
    }
    .form-control:read-only {
      background-color: #f8f9fa;
    }
    .note-editor.note-frame {
      border: 1px solid #ced4da;
    }
    .text-end {
      margin-top: 30px;
    }
    
    .brdtite{
    color: #263c96;
    border-bottom: 2px solid #444;
    padding-bottom: 10px;
    margin-bottom: 20px;
    }
  
   
  
  
    
  </style>
</head>
<body class="container mt-5">

  <h3 class="brdtite"> 강의 추천 게시글 작성</h3>

  <form th:action="@{/csj/writeOk}" method="post" enctype="multipart/form-data">
    <div class="mb-3">
      <label for="title" class="form-label">제목</label>
      <input type="text" class="form-control" id="title" name="title" placeholder="제목을 입력하세요" required maxlength="200" >
    </div>

    <div class="mb-3">
      <label for="nickname" class="form-label">작성자</label>
      <input type="text" class="form-control" id="nickname" name="nickname" th:value="${session.loginUser.nickname}" readonly>
    </div>

    <input type="hidden" name="userId" th:value="${session.loginUser.userSeq}" />

    <div class="mb-3">
      <label for="content" class="form-label">내용</label>
      <textarea id="content" name="content" class="form-control"></textarea>
    </div>

    <div class="text-end">
      <button type="submit" class="btn btn-primary px-4">등록</button>
      <a th:href="@{/csj/community}" class="btn btn-outline-secondary px-4">취소</a>
    </div>
  </form>

  <script>
  $(document).ready(function () {
	  $('#content').summernote({
		  height: 300,
		  callbacks: {
		    onImageUpload: function(files) {
		      for (let i = 0; i < files.length; i++) {
		        uploadImage(files[i]);
		      }
		    }
		  }
		});

		function uploadImage(file) {
		  const formData = new FormData();
		  formData.append("image", file);

		  $.ajax({
		    url: "/csj/uploadImage",
		    type: "POST",
		    data: formData,
		    processData: false,
		    contentType: false,
		    success: function (imageUrl) {
		      $('#content').summernote('insertImage', imageUrl);
		    },
		    error: function () {
		      alert("이미지 업로드 실패");
		    }
		  });
		}
		
		 $('form').on('submit', function (e) {
		      const title = $('#title').val();
		      if (title.length > 200) {
		        alert("제목은 200자 이하로 입력해주세요.");
		        e.preventDefault();
		        return false;
		      }
		    });

  });
</script>

</body>
</html>