<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>

<!-- Chart.js Ï†ÑÏó≠ Î°úÎìú -->
<script src="/js/chart.umd.js"></script>

<!-- drawCharts Ìï®Ïàò Ï†ïÏùò ÌååÏùº -->
<script src="/js/dashboardCharts.js"></script>

  <meta charset="UTF-8">
  <title>ÎßàÏù¥ÌéòÏù¥ÏßÄ</title>
<style>
  body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background-color: #f0f2f5;
  }

  .container {
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(to right, #709dff, #9ec2ff);
    padding: 15px 30px;
    color: white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    position: relative;
  }

  .logo img {
    height: 40px;
    border-radius: 8px;
  }

  .nav-center {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 24px;
    font-weight: 600;
  }

  .nav-center a {
    text-decoration: none;
    color: white;
    font-size: 16px;
    position: relative;
    padding: 6px 10px;
  }

  .nav-center a::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: -4px;
    width: 100%;
    height: 2px;
    background-color: white;
    transform: scaleX(0);
    transition: transform 0.3s ease;
  }

  .nav-center a:hover::after {
    transform: scaleX(1);
  }

  .separator {
    width: 2px;
    height: 20px;
    background-color: rgba(255,255,255,0.5);
    border-radius: 1px;
  }

  .nav-right {
    display: flex;
    gap: 12px;
    margin-left: auto;
  }

  .nav-right a {
    text-decoration: none;
    color: white;
    font-weight: bold;
    background-color: rgba(255, 255, 255, 0.25);
    padding: 8px 16px;
    border-radius: 20px;
    transition: background 0.25s;
  }

  .nav-right a:hover {
    background-color: rgba(255, 255, 255, 0.4);
  }

  .main-content {
    display: flex;
    flex: 1;
    overflow: hidden;
  }

  .sidebar {
    flex: 0 0 240px;
    background-color: #ffffff;
    border-right: 1px solid #e0e0e0;
    overflow-y: auto;
    padding-top: 20px;
    box-shadow: 2px 0 4px rgba(0,0,0,0.03);
  }

  .sidebar-header {
    font-size: 20px;
    font-weight: bold;
    padding: 0 20px 20px;
    color: #3f51b5;
  }

  .sidebar-menu {
    list-style: none;
    padding: 0 20px;
  }

  .sidebar-menu li {
    margin: 12px 0;
  }

  .sidebar-menu a {
    color: #333;
    text-decoration: none;
    font-weight: 500;
    display: block;
    padding: 8px 12px;
    border-radius: 8px;
    transition: background 0.2s;
  }

  .sidebar-menu a:hover {
    background-color: #e3ecff;
    color: #1a3acc;
  }

  .content-area {
    flex: 1;
    background-color: #f9fbfe;
    padding: 30px;
    overflow-y: auto;
    
    max-width: 1200px;   /* ÏµúÎåÄ ÎÑàÎπÑ Ï†úÌïú */
    margin: 0 auto;      /* Í∞ÄÏö¥Îç∞ Ï†ïÎ†¨ */
  }
	/* ÏàòÍ∞ï ÎÇ¥Ïó≠ Ïπ¥Îìú Ïä§ÌÉÄÏùº (Í∏∞Ï°¥ ÌÖåÏù¥Î∏îÍ≥º Î≥ÑÍ∞úÎ°ú ÎèôÏûë) */
	.lecture-grid {
	  display: grid;
	  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
	  gap: 20px;
	}
	
	.info-section {
  margin-top: 30px;
  padding: 20px;
  background-color: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
}

.info-title {
  font-size: 22px;
  color: #3f51b5;
  margin-bottom: 20px;
  font-weight: bold;
}

.info-table {
  width: 100%;
  border-collapse: collapse;
  background-color: white;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.info-table th,
.info-table td {
  padding: 12px 15px;
  border-bottom: 1px solid #eee;
  text-align: left;
}

.info-table th {
  background-color: #f0f4ff;
  font-weight: 600;
  color: #333;
  width: 150px;
}

.info-table td {
  color: #555;
  vertical-align: middle;
}

.info-profile-img {
  height: 60px;
  border-radius: 10px;
  object-fit: cover;
}

.info-button {
  background-color: #3f51b5;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.2s;
  font-size: 14px;
  margin-left: 10px;
}

.info-button:hover {
  background-color: #3143a1;
}

.info-password-button {
  margin-left: 10px;
  background-color: #6c63ff;
}

.info-flex {
  display: flex;
  align-items: center;
  gap: 10px;
}

.info-leave-button {
  margin-top: 24px;
  background-color: #ff4d4f;
  color: white;
  padding: 10px 18px;
  border: none;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
  transition: background-color 0.2s;
}

.info-leave-button:hover {
  background-color: #e04848;
}

	.lecture-card {
	  background: #ffffff;
	  border: 1px solid #ddd;
	  border-radius: 12px;
	  padding: 20px;
	  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.04);
	  transition: transform 0.2s ease;
	}
	
	.lecture-card:hover {
	  transform: translateY(-4px);
	}
	
	.lecture-title {
	  font-size: 16px;
	  font-weight: 600;
	  margin-bottom: 4px;
	  color: #333;
	}
	
	.video-title {
	  font-size: 14px;
	  color: #666;
	  margin-bottom: 10px;
	}
	
	.progress-bar {
	  width: 100%;
	  height: 10px;
	  background-color: #eee;
	  border-radius: 5px;
	  overflow: hidden;
	  margin-bottom: 8px;
	}
	
	.progress {
	  height: 100%;
	  background: #4a76ff;
	  border-radius: 5px;
	  transition: width 0.3s ease;
	}
	
	.progress-text {
	  font-size: 14px;
	  color: #444;
	  margin-bottom: 10px;
	}
	
	.complete-text {
	  font-size: 14px;
	  color: #2e7d32;
	  font-weight: bold;
	}
	
	.go-button {
	  display: inline-block;
	  padding: 8px 14px;
	  background-color: #5c6bc0;
	  color: white;
	  border-radius: 8px;
	  text-decoration: none;
	  font-size: 14px;
	  font-weight: bold;
	  transition: background 0.3s;
	}
	
	.go-button:hover {
	  background-color: #3949ab;
	}

.subcard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 24px;
}

.subcard {
  background-color: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  transition: transform 0.2s ease;
}

.subcard:hover {
  transform: translateY(-6px);
}

.subcard-thumb {
  width: 100%;
  height: 140px;
  object-fit: cover;
  border-top-left-radius: 12px;
  border-top-right-radius: 12px;
}

.subcard-title {
  font-size: 15px;
  font-weight: bold;
  margin: 12px 16px 4px;
  color: #333;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.subcard-sub {
  font-size: 13px;
  color: #666;
  margin: 0 16px 12px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.subcard-bottom {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 16px 16px;
  margin-top: auto;
}

.subcard-date {
  font-size: 12px;
  color: #888;
}

.subcard-unsub {
  background-color: #ff5e5e;
  color: white;
  padding: 6px 12px;
  border: none;
  border-radius: 6px;
  font-size: 13px;
  cursor: pointer;
  transition: background-color 0.2s;
}

.subcard-unsub:hover {
  background-color: #e04848;
  
  h2 {
    font-size: 22px;
    color: #3f51b5;
    margin-bottom: 20px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background-color: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }

  th, td {
    padding: 12px 15px;
    border-bottom: 1px solid #eee;
    text-align: left;
  }

  th {
    background-color: #f0f4ff;
    font-weight: 600;
    color: #333;
  }

  td {
    color: #555;
  }

  button {
    background-color: #3f51b5;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.2s;
  }

  button:hover {
    background-color: #3143a1;
  }
</style>

<script>
// ÏΩòÌÖêÏ∏† ÏòÅÏó≠ ÎπÑÎèôÍ∏∞ Î°úÎìú
function loadContent(url) {
  fetch(url)
    .then(res => res.text())
    .then(html => {
      console.log("üöÄ Loaded HTML:", html);  //ÎîîÎ≤ÑÍπÖ Ïö©
      const contentArea = document.querySelector("#content-area");
      contentArea.innerHTML = html;
      history.replaceState(null, '', '/mypage?tab=' + url.split('/').pop());

      // ÎåÄÏãúÎ≥¥ÎìúÎùºÎ©¥ Ï∞®Ìä∏ Ìï®Ïàò Ïã§Ìñâ
      if (url.includes("dashboard") && typeof window.drawCharts === 'function') {
        setTimeout(() => window.drawCharts(), 50);  // DOM Î†åÎçîÎßÅ ÌõÑ Ïã§Ìñâ
      }
    })
    .catch(err => console.error("ÎÇ¥Ïö© Î°úÎìú Ïã§Ìå®:", err));
}

// ÏÇ¨Ïù¥ÎìúÎ∞î Î©îÎâ¥ ÌÅ¥Î¶≠ Ïãú Ajax Î°úÎìú
function initSidebarClick() {
  document.querySelector(".sidebar").addEventListener("click", function (e) {
    const target = e.target.closest("a");
    if (target && target.getAttribute("href").startsWith("/mypage/")) {
      e.preventDefault();
      loadContent(target.getAttribute("href"));
    }
  });
}

// ÌéòÏù¥ÏßÄ Î°úÎìúÏãú Í∏∞Î≥∏ ÌÉ≠ Î°úÎìú
document.addEventListener("DOMContentLoaded", function () {
  const urlParams = new URLSearchParams(window.location.search);
  const tab = urlParams.get("tab") || "dashboard";
  loadContent("/mypage/" + tab);
  initSidebarClick();
});

// ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú
function uploadProfile() {
  const fileInput = document.getElementById("profileFile");
  const file = fileInput.files[0];
  if (!file) return;

  const formData = new FormData();
  formData.append("file", file);

  fetch("/mypage/upload_profile", {
    method: "POST",
    body: formData
  })
  .then(resp => resp.json())
  .then(data => {
    if (data.success) {
      const newSrc = data.newPath + "?t=" + new Date().getTime(); // Ï∫êÏãú Ïö∞Ìöå
      document.getElementById("profilePreview").src = newSrc;
      alert("ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄÍ∞Ä Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.");
    } else {
      alert("ÏóÖÎ°úÎìú Ïã§Ìå®: " + data.message);
    }
  })
  .catch(err => alert("ÏóêÎü¨ Î∞úÏÉù: " + err));
}

// Íµ¨ÎèÖ Ï∑®ÏÜå ÏöîÏ≤≠
function unsubscribe(followeeId) {
  fetch('/mypage/unsubscribe', {
    method: 'POST',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: 'followee_id=' + followeeId
  })
  .then(res => {
    if (res.ok) {
      alert('Íµ¨ÎèÖ Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§.');
      location.reload();
    } else {
      alert('ÏóêÎü¨Í∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
    }
  });
}

</script>



</head>

<body>
<div class="container">

  <!-- Ìó§Îçî Fragment -->
  <div class="header" th:replace="~{mypage/user_header :: header}"></div>

  <div class="main-content">
    <!-- ÏÇ¨Ïù¥ÎìúÎ∞î Fragment -->
    <div class="sidebar" th:replace="~{mypage/sidebar :: sidebar}"></div>

    <!-- ÎèôÏ†Å ÏΩòÌÖêÏ∏† ÏòÅÏó≠ -->
    <div class="content-area" id="content-area"></div>
  </div>
</div>
</body>
</html>
