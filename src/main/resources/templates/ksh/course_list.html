<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LangTrip - 강의 목록</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/course_list.css}">

</head>
<body class="">
    <!-- Header -->
      <div th:replace="layout/header :: header"></div>


    <main class="main-container">
    <div class="page-header">
        <div>
            <h1 class="page-title">전체 강의</h1>
<p class="results-count" th:if="${courses != null}" th:text="'총 ' + ${#lists.size(courses)} + '개의 강의'"></p>
<p class="results-count" th:unless="${courses != null}">총 0개의 강의</p>        </div>
    </div>

    <div class="search-filter-section">
        <div class="search-container">
            <input type="text" class="search-input" placeholder="원하는 강의를 검색해보세요..." id="searchInput" />
            <span class="search-icon">🔍</span>
        </div>
            
            <div class="filter-row">
                <div class="filter-group">
                    <label class="filter-label">카테고리</label>
                    <select class="filter-select" id="categoryFilter">
                        <option value="">전체 카테고리</option>
                        <option value="development">개발</option>
                        <option value="design">디자인</option>
                        <option value="marketing">마케팅</option>
                        <option value="ai-ml">AI/ML</option>
                        <option value="mobile">모바일</option>
                        <option value="cloud">클라우드</option>
                        <option value="data">데이터 분석</option>
                        <option value="business">비즈니스</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">난이도</label>
                    <select class="filter-select" id="levelFilter">
                        <option value="">전체 난이도</option>
                        <option value="beginner">초급</option>
                        <option value="intermediate">중급</option>
                        <option value="advanced">고급</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">가격</label>
                    <select class="filter-select" id="priceFilter">
                        <option value="">전체 가격</option>
                        <option value="free">무료</option>
                        <option value="0-50000">5만원 이하</option>
                        <option value="50000-100000">5만원~10만원</option>
                        <option value="100000+">10만원 이상</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">정렬</label>
                    <select class="filter-select" id="sortFilter">
                        <option value="popular">인기순</option>
                        <option value="newest">최신순</option>
                        <option value="rating">평점순</option>
                        <option value="price-low">가격 낮은순</option>
                        <option value="price-high">가격 높은순</option>
                    </select>
                </div>
                
                <div class="filter-buttons">
                    <button class="filter-btn" onclick="applyFilters()">검색</button>
                    <button class="clear-filters" onclick="clearFilters()">초기화</button>
                </div>
            </div>
            
            <div class="active-filters" id="activeFilters" style="display: none;">
                <!-- Active filter tags will be inserted here -->
            </div>
        </div>

         <!-- 강의 목록 -->
    <div class="course-grid" id="courseGrid">
        <div class="course-card" th:each="course : ${courses}">
            <div class="course-thumbnail">
                <div class="course-level" th:text="${course.difficulty}">중급</div>
                <div class="course-duration" th:text="${course.duration}">12시간</div>
                <img th:src="@{/images/quiz/{thumbnailName}(thumbnailName=${course.thumbnailName})}" th:alt="${course.title}" style="width:100%; height:auto;"/>
            </div>
            <div class="course-info">
                <span class="course-category" th:text="${course.category}">개발</span>
                <h3 class="course-title" th:text="${course.title}">React 완벽 마스터</h3>
                <div class="course-instructor">
                    <div class="instructor-avatar" th:text="${course.instructorNickname != null ? course.instructorNickname.substring(0,1) : ''}">김</div>
                    <span class="instructor-name" th:text="${course.instructorNickname}">김개발</span>
                </div>
                <div class="course-stats">
                    <div class="course-rating">⭐ <span th:text="${course.rating}">4.9</span> (<span th:text="${course.students}">1234</span>)</div>
                    <div class="course-students" th:text="${course.students} + '명 수강'">1234명 수강</div>
                </div>
                <div class="course-footer">
                    <div class="course-price">
                        <span class="original-price" th:if="${course.originalPrice != course.currentPrice}" th:text="'₩' + ${#numbers.formatInteger(course.originalPrice, 0)}">₩129,000</span>
                        <span class="current-price" th:text="'₩' + ${#numbers.formatInteger(course.currentPrice, 0)}">₩89,000</span>
                    </div>
                    <a th:href="@{/courses/enroll/{courseSeq}(courseSeq=${course.courseSeq})}" class="enroll-btn">수강신청</a>
                </div>
            </div>
        </div>
    </div>


        <!-- Pagination -->
        <div class="pagination" id="pagination">
            <button th:if="${pageResponseDTO.prev}" th:onclick="'goToPage(' + ${pageResponseDTO.startPage - 1} + ')'" id="prevBtn">이전</button>
            <th:block th:each="i : ${#numbers.sequence(pageResponseDTO.startPage, pageResponseDTO.endPage)}">
                <button th:onclick="'goToPage(' + ${i} + ')'" th:classappend="${i == pageResponseDTO.page ? 'active' : ''}">[[${i}]]</button>
            </th:block>
            <button th:if="${pageResponseDTO.next}" th:onclick="'goToPage(' + ${pageResponseDTO.endPage + 1} + ')'" id="nextBtn">다음</button>
        </div>
          <div th:replace="layout/footer :: footer"></div>
        
    </main>
    

    <script>
        function goToPage(page) {
            const url = new URL(window.location.href);
            url.searchParams.set("page", page);
            window.location.href = url.toString();
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value;
            const category = document.getElementById('categoryFilter').value;
            const difficulty = document.getElementById('levelFilter').value;
            const priceRange = document.getElementById('priceFilter').value;
            const sort = document.getElementById('sortFilter').value;

            const url = new URL(window.location.href);
            url.searchParams.set("searchTerm", searchTerm);
            url.searchParams.set("category", category);
            url.searchParams.set("difficulty", difficulty);
            url.searchParams.set("priceRange", priceRange);

            const [orderBy, order] = sort.split(",");
            url.searchParams.set("orderBy", orderBy);
            url.searchParams.set("sort", order);
            url.searchParams.set("page", 1); // Reset to first page on filter change

            window.location.href = url.toString();
        }

        function clearFilters() {
            const url = new URL(window.location.href);
            url.searchParams.delete('searchTerm');
            url.searchParams.delete('category');
            url.searchParams.delete('difficulty');
            url.searchParams.delete('priceRange');
            url.searchParams.delete('orderBy');
            url.searchParams.delete('sort');
            url.searchParams.set('page', 1);
            window.location.href = url.toString();
        }

        // Search input event listener
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                applyFilters();
            }
        });

        // Filter change event listeners
        document.getElementById('categoryFilter').addEventListener('change', applyFilters);
        document.getElementById('levelFilter').addEventListener('change', applyFilters);
        document.getElementById('priceFilter').addEventListener('change', applyFilters);
        document.getElementById('sortFilter').addEventListener('change', applyFilters);

        // Initialize filter values from URL parameters
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            document.getElementById('searchInput').value = urlParams.get('searchTerm') || '';
            document.getElementById('categoryFilter').value = urlParams.get('category') || '';
            document.getElementById('levelFilter').value = urlParams.get('difficulty') || '';
            document.getElementById('priceFilter').value = urlParams.get('priceRange') || '';

            const orderBy = urlParams.get('orderBy') || 'popular';
            const sortOrder = urlParams.get('sort') || '';
            document.getElementById('sortFilter').value = `${orderBy},${sortOrder}`;
        });
    </script>
</body>
</html>