<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.sist.e_learning.community.CommunityPostDAO">

  <insert id="insertPost" parameterType="kr.co.sist.e_learning.community.CommunityPostDTO">
    INSERT INTO community_post (
      post_id, user_id, title, content, created_at, views, post_state
    ) VALUES (
      seq_community_post.NEXTVAL,
      #{userId},
      #{title},
      #{content},
      SYSTIMESTAMP,
      0,
      'A'
    )
  </insert>

  <select id="selectAllPosts" resultType="kr.co.sist.e_learning.community.CommunityPostDTO">
  SELECT 
    cp.post_id AS postId,
    cp.user_id AS userId,
    u.nickname AS nickname,  <!-- 추가 -->
    cp.title,
    cp.content,
    cp.created_at AS createdAt,
    cp.views,
    cp.post_state AS postState
  FROM community_post cp
  JOIN users u ON cp.user_id = u.user_seq
  WHERE cp.post_state = 'A'
  ORDER BY cp.post_id DESC
</select>

  <select id="selectPost" parameterType="long" resultType="kr.co.sist.e_learning.community.CommunityPostDTO">
    SELECT 
      post_id AS postId,
      user_id AS userId,
      title,
      content,
      created_at AS createdAt,
      views,
      post_state AS postState
    FROM community_post
    WHERE post_id = #{postId}
  </select>

</mapper>
